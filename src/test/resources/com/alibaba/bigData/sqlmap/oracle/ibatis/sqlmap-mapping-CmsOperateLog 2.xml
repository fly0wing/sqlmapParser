<?xml version='1.0' encoding="gb2312"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN"
    "http://www.ibatis.com/dtd/sql-map-2.dtd">

<!-- WARNING: This is an autogenerated file -->

<sqlMap namespace="cms_CmsOperateLog">        
        
    <resultMap class="CmsOperateLog" id="CmsOperateLog-result">
        <result property="gmtCreate"			javaType="java.sql.Timestamp"		column="GMT_CREATE" />
        <result	property="gmtModified"			javaType="java.sql.Timestamp"		column="GMT_MODIFIED" />
        <result	property="id"				javaType="java.lang.Long"			column="ID" />
		<result property="operate"			javaType="java.lang.String"			column="OPERATE" />
        <result property="content"			javaType="java.lang.String"			column="CONTENT" />
		<result property="userId"			javaType="java.lang.String"			column="USER_ID" />
    </resultMap>
	
	
    <insert id="MS-INSERT"  parameterClass="CmsOperateLog" >
	   <selectKey resultClass="java.lang.Long" keyProperty="id">
            SELECT SEQ_CMS_OPERATE_LOG.NEXTVAL AS id FROM DUAL
        </selectKey>
        <![CDATA[
            insert into CMS_OPERATE_LOG
              (GMT_CREATE  , GMT_MODIFIED  , ID  , CONTENT , OPERATE , USER_ID)
            values
              (SYSDATE  , SYSDATE  , #id#  , #content# ,#operate#,#userId#)
        ]]>
    </insert>
    
	
	 <select id="MS-QUERY-BY-USERID-AND-DATES" parameterClass="java.util.Map" resultMap="CmsOperateLog-result">	
		<![CDATA[
		SELECT * FROM 
			  (SELECT A.*,ROWNUM RN FROM
	               (SELECT log.*,ROWNUM rnum FROM CMS_OPERATE_LOG log WHERE USER_ID LIKE  #userId#||'%'
		]]>
		<isNotEmpty prepend="AND" property="startTime">
		<![CDATA[ GMT_CREATE >= TO_DATE(#startTime#, 'YYYY-MM-DD')]]>
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="endTime">
		<![CDATA[ GMT_CREATE < TO_DATE(#endTime#, 'YYYY-MM-DD')+1]]>
		</isNotEmpty>	
		<![CDATA[ ORDER BY ID DESC) A
               WHERE ROWNUM <= #offset# + #length#
          ) WHERE RN > #offset#
		]]>
    </select> 
	

	
	<select id="MS-COUNT-BY-TIME-USER-ID" parameterClass="java.util.Map"  resultClass="java.lang.Integer" >
	     <![CDATA[
				SELECT count(*)  FROM  CMS_OPERATE_LOG WHERE USER_ID LIKE #userId#||'%'
		 ]]> 
		<isNotEmpty prepend="AND" property="startTime">
		<![CDATA[ GMT_CREATE >= TO_DATE(#startTime#, 'YYYY-MM-DD')]]>
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="endTime">
		<![CDATA[ GMT_CREATE < TO_DATE(#endTime#, 'YYYY-MM-DD')+1]]>
		</isNotEmpty>	
    </select>
	
	

</sqlMap>
