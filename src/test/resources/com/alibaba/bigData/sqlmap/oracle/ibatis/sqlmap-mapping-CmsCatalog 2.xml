<?xml version='1.0' encoding="gb2312"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN"
    "http://www.ibatis.com/dtd/sql-map-2.dtd">

<!-- WARNING: This is an autogenerated file -->

<sqlMap namespace="cms_CmsCatalog">        

    <resultMap class="CmsCatalog" id="CmsCatalog-result" >
        <result property="gmtCreate"	javaType="java.sql.Timestamp"	column="GMT_CREATE" />
        <result property="gmtModified"	javaType="java.sql.Timestamp"	column="GMT_MODIFIED" />
        <result property="id"			javaType="java.lang.Long"		column="ID" />
        <result property="name"			javaType="java.lang.String"		column="NAME" />
        <result property="parentId"		javaType="java.lang.Long"		column="PARENT_ID" />
		<result property="lev"		    javaType="java.lang.Integer"    column="LEV" />
		<result property="remarks"      javaType="java.lang.String"     column="REMARKS"/>
		<result property="lev"		javaType="java.lang.Integer"		column="LEV" />
	    <result property="remarks"    javaType="java.lang.String"       column="REMARKS"/>
	    <result property="siteId"    javaType="java.lang.Long"       column="SITE_ID"/>
    </resultMap>
    
      <resultMap id="CmsCatalogRes-result"  class="java.util.HashMap">		
		<result property="id" javaType="java.lang.Long" column="ID" />
		<result property="name" javaType="java.lang.String" column="NAME" />
		<result property="resourceId" javaType="java.lang.Long" column="RESOURCE_ID" />
	</resultMap>
	
    <resultMap id="CmsCatalogPath-result"  class="CmsCatalog">		
		<result property="id"         javaType="java.lang.Long"         column="ID" />
		<result property="name"       javaType="java.lang.String"       column="NAME" />
		<result property="remarks"    javaType="java.lang.String"       column="REMARKS"/>
	</resultMap>		

    <select id="getCmsCatalog" parameterClass="java.lang.Long" resultMap="CmsCatalog-result">
        <![CDATA[
            SELECT * FROM CMS_CATALOG_V2 where ID = #id#  
        ]]>
    </select>
    <select id="getCmsCatalogBySiteId" parameterClass="java.lang.Long" resultMap="CmsCatalog-result">
        <![CDATA[
            SELECT * FROM CMS_CATALOG_V2 where SITE_ID = #siteId#
        ]]>
    </select>
    <update id="MS_UPDATE_CATEGORY_BY_ID" parameterClass="CmsCatalog" >
        <![CDATA[
            update CMS_CATALOG_V2
            	set GMT_CREATE = #gmtCreate# , 
                    GMT_MODIFIED = #gmtModified# , 
                    NAME = #name# , 
					PARENT_ID = #parentId# ,
					LEV=#lev#,
					REMARKS=#remarks#
            where  ID = #id#
        ]]>
    </update>

    <delete id="deleteCmsCatalog" parameterClass="java.lang.Long"  >
        <![CDATA[
            delete from CMS_CATALOG_V2 where ID = #id# 
        ]]>
    </delete>
    
    <select id="MS-SELECT-ALL-CMSCATALOG" resultClass="CmsCatalog" resultMap="CmsCatalog-result" >
        <![CDATA[
            select * from CMS_CATALOG_V2 order by GMT_CREATE desc
        ]]>
    </select>
    
    <select id="MS-SELECT-ALL-PARENT-CMSCATALOG" parameterClass="map"  resultClass="java.lang.Long" >
        <![CDATA[
            select id from CMS_CATALOG_V2 where parent_id=#parentId#
        ]]>
        <isNotEmpty prepend="AND" property="siteId" >
		 SITE_ID=#siteId#
		</isNotEmpty>
        <![CDATA[
         order by id desc
        ]]>
    </select>
    
    <select id="MS-GET-ALL-PRIMARY-CATALOGS" resultClass="CmsCatalog">
        <![CDATA[
            select * from CMS_CATALOG_V2 WHERE parent_id=0 order by id desc
        ]]>    
    </select>
	
	<select id="MS_SELECT_FIRSTCATAGORY_BY_PRAENT_ID" resultMap="CmsCatalog-result" parameterClass="map">
		<![CDATA[
			SELECT * FROM (
				SELECT catalog.*,ROWNUM rn FROM (
					SELECT * FROM CMS_CATALOG_V2 where PARENT_ID = #parentId#	order by ID DESC	
				) catalog where ROWNUM <= #offerset# + #length#
			) where rn>#offerset#
		]]>
	</select>
	<select id="MS_COUNT_CATAGORY_BY_PARENTID" resultClass="java.lang.Long" parameterClass="java.lang.Long">
		<![CDATA[
			SELECT COUNT(*) FROM CMS_CATALOG_V2 WHERE PARENT_ID = #parentId#
		]]>
	</select>
	<select id="MS_COUNT_CATALOG_BY_PARENTID_AND_NAME" parameterClass="map" resultClass="java.lang.Integer">
		<![CDATA[
			SELECT COUNT(*) FROM CMS_CATALOG_V2 WHERE NAME = #name#  AND PARENT_ID = #parentId# 
		]]>
		<isNotEmpty prepend="AND" property="siteId" >
		 SITE_ID=#siteId#
		</isNotEmpty>
		<isGreaterThan prepend="AND" property="id" compareValue="0">
			ID != #id#
		</isGreaterThan>
	</select>
	

	
	<insert id="MS_ADD_CATEGORY" parameterClass="CmsCatalog">		
		<selectKey resultClass="java.lang.Long" keyProperty="id">
			SELECT SEQ_CMS_CATALOG.NEXTVAL AS ID FROM DUAL
		</selectKey>
		<![CDATA[
			INSERT INTO CMS_CATALOG_V2 
				(GMT_CREATE , GMT_MODIFIED , ID , NAME ,  PARENT_ID , LEV,REMARKS,SITE_id)
			values
				(SYSDATE , SYSDATE , #id# , #name# ,  #parentId# , #lev#,#remarks#,#siteId#)
		]]>
	</insert>
	
	<select id="getParentCatagorysByLetterASC" resultClass="CmsCatalog">
        <![CDATA[
            select * from CMS_CATALOG_V2 where PARENT_ID=0 order by NAME asc
        ]]>    
    </select>

    <select id="getCmsCatalogByResource" parameterClass="java.util.Map" resultMap="CmsCatalog-result">
        <![CDATA[
            SELECT * FROM CMS_CATALOG_V2 where ID in (	SELECT CATALOG_ID FROM CMS_RESOURCE_CATALOG_V2 where RESOURCE_ID=#resourceId# and RESOURCE_TYPE=#resourceType#)
        ]]>
    </select>
    <select id="MS_GET_RESOURCE_CATALOG" parameterClass="java.util.Map" resultClass="java.lang.Long">
        <![CDATA[
            SELECT P.CATALOG_ID
			  FROM CMS_RESOURCE_CATALOG_V2 P
			 WHERE P.RESOURCE_ID = #resourceId#
			   AND P.RESOURCE_TYPE = #resourceType#
        ]]>    
    </select>
	<select id="MS_GET_CATALOGS_BY_IDS" resultMap="CmsCatalog-result" parameterClass="Collection">
		SELECT * FROM CMS_CATALOG_V2 WHERE ID in 
		<iterate open="(" close=")" conjunction=",">
			#[]#
		</iterate>
	</select>  
	
	<select id="DCMS_QUERY_CATALOG_BY_RESOURCEID"  resultMap="CmsCatalogRes-result" parameterClass="java.util.Map">
		<![CDATA[  
			SELECT DISTINCT C.ID, C.NAME, RC.RESOURCE_ID
				  FROM CMS_CATALOG_V2 C, CMS_RESOURCE_CATALOG_V2 RC
				 WHERE C.ID = RC.CATALOG_ID
				   AND RC.RESOURCE_TYPE = #resourceType#
				   AND RC.RESOURCE_ID IN (
				  	]]>
				  <iterate property="resList" conjunction=",">
				 			#resList[]#
				 </iterate>
			)
    </select>  

    
     <select id="MS-SELECT-CATEGORY-BY-PARENT-ID" parameterClass="java.lang.Long"  resultClass="CmsCatalog" >
        <![CDATA[
            select * from CMS_CATALOG_V2 where parent_id=#value# order by id desc
        ]]>
    </select>

	<select id = "MS-SELECT-CATALOG-IDS-TREE" parameterClass="Collection" resultClass = "java.lang.Long" >
    	<![CDATA[
            SELECT ID FROM CMS_CATALOG_V2 START WITH ID IN  
        ]]>			
			<iterate open="(" close=")" conjunction=",">
			#[]#
			</iterate>
    	<![CDATA[			
			 CONNECT BY NOCYCLE PRIOR ID = PARENT_ID 
        ]]>
    </select>   
    
    <select id="MS-SELECT-CATALOG-PATH" parameterClass="java.util.List" resultMap="CmsCatalogPath-result">
        <![CDATA[
		SELECT ID, NAME, sys_connect_by_path(ID,'/') as REMARKS 
		from CMS_CATALOG_V2 b 
		WHERE PARENT_ID=0 
		]]>
	    START WITH ID in 
		<iterate open="(" close=")" conjunction=",">
			#[]#
		</iterate>
		<![CDATA[
		CONNECT BY NOCYCLE PRIOR  parent_id = id
		ORDER BY ID ASC, REMARKS ASC
		]]>
	</select>	    
	<select id="getCatagoryByRefId" parameterClass="java.util.Map" resultMap="CmsCatalog-result" resultClass="CmsCatalog"> 
        <![CDATA[
            SELECT * FROM CMS_CATALOG_V2 where SITE_ID = #siteId# and NAME like '%'|| #refId# || '%'
         ]]>
	</select>
</sqlMap>
