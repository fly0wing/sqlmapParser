<?xml version='1.0' encoding="gb2312"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN"
    "http://www.ibatis.com/dtd/sql-map-2.dtd">

<!-- WARNING: This is an autogenerated file -->

<sqlMap namespace="cms_CmsTemplateUser">        
        
    <resultMap class="CmsTemplateUser" id="CmsTemplateUser-result" >
        <result 
                property="id" 
                javaType="java.lang.Long"
                column="ID" 
        />
        <result 
                property="gmtCreate" 
                javaType="java.sql.Timestamp"
                column="GMT_CREATE" 
        />
        <result 
                property="gmtModified" 
                javaType="java.sql.Timestamp"
                column="GMT_MODIFIED" 
        />
        <result 
                property="templateId" 
                javaType="java.lang.Long"
                column="TEMPLATE_ID" 
        />
        <result 
                property="userId" 
                javaType="java.lang.String"
                column="USER_ID" 
        />
        <result 
                property="permission" 
                javaType="java.lang.String"
                column="PERMISSION" 
        />
    </resultMap>

    <select id="getCmsTemplateUser" 
        resultClass="CmsTemplateUser" 
        parameterClass="CmsTemplateUser" 
        resultMap="CmsTemplateUser-result" >
        <![CDATA[
            select
                ID  ,
                GMT_CREATE  ,
                GMT_MODIFIED  ,
                TEMPLATE_ID  ,
                USER_ID  ,
                PERMISSION 
            from
                CMS_TEMPLATE_USER
            where 
                ID = #id# 

        ]]>
    </select>

    <update id="updateCmsTemplateUser" 
        parameterClass="CmsTemplateUser" >
        <![CDATA[
            update
                    CMS_TEMPLATE_USER
            set
                    GMT_CREATE = #gmtCreate# , 
                    GMT_MODIFIED = #gmtModified# , 
                    TEMPLATE_ID = #templateId# , 
                    USER_ID = #userId# , 
                    PERMISSION = #permission#     
            where  
                ID = #id#
        ]]>
    </update>

    <insert id="insertCmsTemplateUser" 
        parameterClass="CmsTemplateUser" >
        <selectKey resultClass="java.lang.Long" keyProperty="id"> SELECT SEQ_CMS_TEMPLATE_USER.NEXTVAL AS id FROM DUAL </selectKey>
        <![CDATA[            
            insert into CMS_TEMPLATE_USER
              (ID  , GMT_CREATE  , GMT_MODIFIED  , TEMPLATE_ID  , USER_ID  , PERMISSION )
            values
              (#id#  , sysdate  , sysdate  , #templateId#  , #userId#  , #permission# )
        ]]>
    </insert>

    <delete id="deleteCmsTemplateUser" parameterClass="CmsTemplateUser"  >
        <![CDATA[
            delete from CMS_TEMPLATE_USER where ID = #id# 
        ]]>
    </delete>
    <select id="MS-SELECT-CMSTMPLATEUSER-BY-PAGEID-USERID" resultClass="java.lang.Long" parameterClass="java.util.Map" >
            SELECT count(*) FROM CMS_TEMPLATE_USER WHERE TEMPLATE_ID = #templateId# AND USER_ID=#userId#
			<isNotNull prepend="AND" property="permission">
				 PERMISSION = #permission#
			</isNotNull>
    </select>
    
    <!--根据模板ID和模板权限，取得模板用户对象-->
    <select id="SELECT-BY-TEMPLATEID-AND-PERMISSION" parameterClass="java.util.Map" resultMap="CmsTemplateUser-result">
        <![CDATA[
            select
                ID  ,
                GMT_CREATE  ,
                GMT_MODIFIED  ,
                TEMPLATE_ID  ,
                USER_ID  ,
                PERMISSION 
            from
                CMS_TEMPLATE_USER
            where 
                TEMPLATE_ID=#templateId# and PERMISSION=#permission#
        ]]>
    </select>
    
    <delete id="deleteTemplateUseByTemplateId"  parameterClass="java.lang.Long" >
        <![CDATA[
            delete from CMS_TEMPLATE_USER where TEMPLATE_ID = #templateId# 
        ]]>
    </delete>
    
    <!--根据权限取得模板的用户ID-->
    <select id="MS-SELECT-USERID-BY-PERMISSION" resultClass="java.lang.String" parameterClass="java.util.Map" >
        SELECT USER_ID FROM CMS_TEMPLATE_USER WHERE TEMPLATE_ID = #templateId# AND PERMISSION = #permission#
    </select>
</sqlMap>
