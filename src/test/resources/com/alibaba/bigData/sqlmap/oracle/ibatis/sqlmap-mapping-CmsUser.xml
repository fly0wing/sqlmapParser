<?xml version='1.0' encoding="gb2312"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN"
    "http://www.ibatis.com/dtd/sql-map-2.dtd">

<!-- WARNING: This is an autogenerated file -->

<sqlMap namespace="cms_CmsUser">

	<resultMap id="CmsUser-result" class="CmsUser">
		<result property="gmtCreate" javaType="java.sql.Timestamp"
			column="GMT_CREATE" />
		<result property="gmtModified" javaType="java.sql.Timestamp"
			column="GMT_MODIFIED" />
		<result property="userId" javaType="java.lang.String" column="USER_ID" />
		<result property="password" javaType="java.lang.String" column="PASSWORD" />
		<result property="fullName" javaType="java.lang.String" column="FULL_NAME" />
		<result property="email" javaType="java.lang.String" column="EMAIL" />
		<result property="roleName" javaType="java.lang.String" column="ROLE_NAME" />
		<result property="depId" javaType="java.lang.String" column="DEP_ID" />
		<result property="profileSite" javaType="java.lang.Long" column="PROFILE_SITE" />

	</resultMap>

	<resultMap id="CmsDcmsUser-result" class="CmsUser" >
		<result property="gmtCreate" javaType="java.sql.Timestamp" column="GMT_CREATE" />
		<result property="gmtModified" javaType="java.sql.Timestamp" column="GMT_MODIFIED" />
		<result property="userId" javaType="java.lang.String" column="USER_ID" />
		<result property="password" javaType="java.lang.String" column="PASSWORD" />
		<result property="fullName" javaType="java.lang.String" column="FULL_NAME" />
		<result property="email" javaType="java.lang.String" column="EMAIL" />
		<result property="depId" javaType="java.lang.String" column="DEP_ID" />
	</resultMap>
	<resultMap id="CmsSite-result"  class="java.util.HashMap">
		<result property="id" javaType="java.lang.Long" column="ID" />
		<result property="parentId" javaType="java.lang.Long" column="PARENT_ID" />
		<result property="name" javaType="java.lang.String" column="NAME" />
		<result property="checked" javaType="java.lang.String" column="CHECKED" />
	</resultMap>
	<resultMap id="CmsDepSite-result"  class="java.util.HashMap">
		<result property="siteId" javaType="java.lang.Long" column="SITE_ID" />
		<result property="depId" javaType="java.lang.String" column="DEP_ID" />
	</resultMap>
	<resultMap id="CmsDep-result"  class="java.util.HashMap">
		<result property="depName" javaType="java.lang.String" column="DEP_NAME" />
		<result property="depId" javaType="java.lang.String" column="DEP_ID" />
	</resultMap>
	<resultMap id="CmsPerm-result"  class="java.util.HashMap">
		<result property="permCode" javaType="java.lang.String" column="PERM_CODE" />
		<result property="description" javaType="java.lang.String" column="DESCRIPTION" />
	</resultMap>

	<resultMap id="CmsGroup-result" class="CmsUser" extends="CmsUser-result">
		<result property="groups" javaType="java.lang.String" column="GROUPS" />
		<result property="groupids" javaType="java.lang.String" column="GROUPIDS" />
		<!-- result property="groups" resultMap="cms_CmsUser.CmsGroup-result-groupName"
			/ -->
	</resultMap>

	<resultMap id="CmsGroup-result-groupName" class="CmsGroup">
		<result property="name" column="GROUP_NAME" />
	</resultMap>

	<resultMap id="userWithGroupInfo" class="java.util.HashMap">
		<result property="userId" column="USER_ID" />
		<result property="groups" javaType="java.lang.String" column="GROUPS" />
		<result property="groupids" javaType="java.lang.String" column="GROUPIDS" />
	</resultMap>

	<resultMap id="SiteWithPrinciple" class="java.util.HashMap">
		<result property="userId" column="USER_ID" />
		<result property="siteId" column="RESOURCE_ID" />
	</resultMap>

	<select id="getCmsUser" resultClass="CmsUser" parameterClass="CmsUser"
		resultMap="CmsUser-result">
        <![CDATA[
            select
                GMT_CREATE  ,
                GMT_MODIFIED  ,
                USER_ID  ,
                PASSWORD  ,
                FULL_NAME  ,
                EMAIL  ,
                ROLE_NAME ,
                DEP_ID,
                PROFILE_SITE
            from
                CMS_USER
            where
                USER_ID = #userId#

        ]]>
	</select>


	<update id="MS-MODIFY-USER" parameterClass="CmsUser">
		update
		CMS_USER
		set
		GMT_MODIFIED = sysdate
		<dynamic prepend="">
			<isNotNull property="password" prepend=",">PASSWORD =
				#password#</isNotNull>
			<isNotNull property="fullName" prepend=",">FULL_NAME =
				#fullName#</isNotNull>
			<isNotNull property="email" prepend=",">EMAIL = #email#
			</isNotNull>
			<isNotNull property="roleName" prepend=",">ROLE_NAME =
				#roleName#</isNotNull>
			<isNotNull property="profileSite" prepend=",">PROFILE_SITE =#profileSite#</isNotNull>
		</dynamic>
		where
		USER_ID = #userId#
	</update>


	<insert id="MS-INSERT-INSERTCMSUSER" parameterClass="CmsUser">
        <![CDATA[
            insert into CMS_USER
              (GMT_CREATE  , GMT_MODIFIED  , USER_ID  , FULL_NAME  , EMAIL  , ROLE_NAME, DEP_ID, PROFILE_SITE )
            values
              (sysdate  , sysdate  , #userId#  , #fullName#  , #email#  , #roleName#, #depId#, #profileSite# )
        ]]>
	</insert>

	<delete id="MS_DELETE_BY_USER_ID" parameterClass="java.lang.String">
        <![CDATA[
            delete from CMS_USER where USER_ID = #userId#
        ]]>
	</delete>

	<select id="MS-GETUSE-BY-NAME-USERID" parameterClass="java.util.Map"
		resultMap="CmsUser-result">
	     <![CDATA[
		    SELECT t1.*
	        FROM (SELECT DISTINCT cmu.*,ROWNUM rnum FROM CMS_USER cmu, CMS_USER_ROLE UR, CMS_ROLE R
	        WHERE (cmu.FULL_NAME LIKE '%'||#userName#||'%' OR cmu.USER_ID LIKE '%'||#userName#||'%')
	           AND CMU.USER_ID = UR.USER_ID
   				AND UR.ROLE_ID = R.ID
	     ]]>
		<isNotEmpty prepend="AND" property="roleName">
			r.ROLE_NAME = #roleName#
		</isNotEmpty>
		<isEmpty prepend="AND" property="roleName">
			r.ROLE_NAME NOT IN
			('guest','SA')
			</isEmpty>
		 <![CDATA[
	        AND   ROWNUM <= #offset# + #length#) t1
            WHERE rnum >#offset#
		 ]]>

	</select>


	<select id="MS-COUNTUSE-BY-NAME-USERID" parameterClass="java.util.Map"
		resultClass="java.lang.Integer">
	     <![CDATA[
            SELECT count(DISTINCT cmu.*)FROM CMS_USER cmu, CMS_USER_ROLE UR, CMS_ROLE R
	        WHERE (cmu.FULL_NAME LIKE '%'||#userName#||'%' OR cmu.USER_ID LIKE '%'||#userName#||'%')
	        AND CMU.USER_ID = UR.USER_ID
   				AND UR.ROLE_ID = R.ID
		 ]]>
		<isNotEmpty prepend="AND" property="roleName">
			r.ROLE_NAME = #roleName#
		</isNotEmpty>
		<isEmpty prepend="AND" property="roleName">
			r.ROLE_NAME NOT IN
			('guest','SA')
			</isEmpty>
	</select>

	<select id="MS-GETUSE-BY-NAME-USERID-ALL" parameterClass="java.util.Map"
		resultMap="CmsUser-result">
	   <![CDATA[
		   SELECT * FROM (
			   SELECT cmu.*,ROWNUM rnum FROM (
				   SELECT usr.* FROM CMS_USER usr, CMS_USER_ROLE UR, CMS_ROLE R
				   WHERE (usr.FULL_NAME LIKE '%'||#userName#||'%' OR usr.USER_ID LIKE '%'||#userName#||'%')
				   AND usr.USER_ID = UR.USER_ID
   					AND UR.ROLE_ID = R.ID
				   ]]>
		<isNotEmpty prepend="AND" property="roleName">
			r.ROLE_NAME = #roleName#
		</isNotEmpty>
	   <![CDATA[
		   ORDER BY GMT_CREATE DESC
			   ) cmu WHERE ROWNUM <= #offset# + #length#
		   ) WHERE rnum >#offset#
	   ]]>
	</select>


	<select id="MS-COUNTUSE-BY-NAME-USERID-ALL" parameterClass="java.util.Map"
		resultClass="java.lang.Integer">
	     <![CDATA[
            SELECT count(DISTINCT usr.*)FROM CMS_USER usr, CMS_USER_ROLE UR, CMS_ROLE R
	        WHERE (usr.FULL_NAME LIKE '%'||#userName#||'%' OR usr.USER_ID LIKE '%'||#userName#||'%')
	        	AND usr.USER_ID = UR.USER_ID
   					AND UR.ROLE_ID = R.ID
		 ]]>
		<isNotEmpty prepend="AND" property="roleName">
			r.ROLE_NAME = #roleName#
		</isNotEmpty>
	</select>


	<select id="MS-USERS-ADDPAGE-BY-USERID" parameterClass="java.util.Map"
		resultMap="CmsUser-result">
		SELECT DISTINCT usr.* FROM CMS_USER USR, CMS_ROLE R, CMS_USER_ROLE UR where usr.USER_ID in (
		<iterate property="peoples" conjunction=",">
			#peoples[]#
		</iterate>
		) AND USR.USER_ID = UR.User_Id AND UR.ROLE_ID = R.ID AND r.ROLE_NAME!='guest' AND r.ROLE_NAME!='SA'
	</select>


	<select id="MS-CHECK-USER-EXIST" parameterClass="string"
		resultMap="CmsUser-result">
		SELECT * FROM CMS_USER where USER_ID = #value#
     </select>


	<select id="MS-GETUSER-BY-USERID" parameterClass="string"
		resultMap="CmsUser-result">
         <![CDATA[
            SELECT * FROM CMS_USER where USER_ID=#value#
         ]]>
	</select>
<!-- 根据用户名更新单个用户角色 -->
	<insert id="MS-MODIFY-USER-ROLE-BY-USERID" parameterClass="java.util.Map">
		<selectKey resultClass="java.lang.Long" keyProperty="id">
            SELECT SEQ_CMS_USER_ROLE.NEXTVAL AS id FROM DUAL
        </selectKey>
        <![CDATA[
         INSERT INTO CMS_USER_ROLE
			  (ID, GMT_MODIFIED, GMT_CREATE, USER_ID, ROLE_ID)
			VALUES
			  (#id#, sysdate, sysdate,#userId#, #roleId#)
        ]]>
	</insert>
	<!-- 查询所有的用户ID为清空缓存使用 -->
	<select id="MS-GET-ALL-USER-ID" resultClass="java.lang.String">
         <![CDATA[
            SELECT USER_ID FROM CMS_USER
         ]]>
	</select>

	<select id="MS_QUERY_POSITION_USERS_BY_GROUPID" parameterClass="java.lang.Long"
		resultClass="String">
		SELECT USER_ID FROM CMS_USER_GROUP WHERE GROUP_ID =
		#groupId# AND POSITION = '1'
    </select>

	<select id="getAllUsers" resultMap="CmsUser-result">
		SELECT *
		FROM CMS_USER
    </select>
    <select id="DCMS-GET-USER-DEPNAME" resultMap="CmsDep-result" parameterClass="java.util.Map">
		SELECT DISTINCT DEP.DEP_ID, DEP.DEP_NAME FROM CMS_DEPARTMENT DEP WHERE DEP.DEP_ID =#depId#
    </select>
    <!-- springyu -->
    <select id="DCMS-DEPARMENT-SITE" parameterClass="java.util.Map" resultClass="java.lang.String">
    	SELECT DISTINCT dc.dep_id FROM CMS_DEPARTMENT_SITE dc WHERE dc.SITE_ID IN(
    	<iterate property="siteList" conjunction=",">
			#siteList[]#
		</iterate>
    	)
    </select>
    <!-- springyu -->
     <select id="DCMS-USER-DEPARMENT" parameterClass="java.util.Map" resultClass="java.lang.String">
    	SELECT DISTINCT U.USER_ID FROM CMS_USER U WHERE U.DEP_ID IN(
    	<iterate property="depList" conjunction=",">
			#depList[]#
		</iterate>
    	)
    </select>
    <select id="DCMS-DCMS-GETUSE-BY-NAME-USERID" parameterClass="java.util.Map"
		resultMap="CmsDcmsUser-result">
	     <![CDATA[
		    SELECT t1.*
	        FROM (SELECT u.*,ROWNUM rnum FROM CMS_USER u
	        WHERE (u.FULL_NAME LIKE '%'||#userId#||'%' OR u.USER_ID LIKE '%'||#userId#||'%')
	     ]]>
	 		<isNotEmpty prepend="AND" property="roleId" >
				U.USER_ID IN (SELECT DISTINCT USR.USER_ID
                               FROM CMS_USER USR, CMS_USER_ROLE R
                              WHERE USR.USER_ID = R.USER_ID
                                AND R.ROLE_ID = #roleId#)
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="isSite" >
			(U.USER_ID IN (SELECT DISTINCT USR.USER_ID
                                FROM CMS_USER USR
                               WHERE USR.DEP_ID  IN (
                                 <iterate property="depList" conjunction=",">
										#depList[]#
									</iterate>
                                 )) OR
               U.USER_ID IN (SELECT DISTINCT USR.USER_ID
                                FROM CMS_USER USR, CMS_USER_SITE UC
                               WHERE USR.USER_ID = UC.USER_ID
                                 AND UC.END_DATE >= SYSDATE
                                 AND UC.SITE_ID IN (
                                  <iterate property="siteList" conjunction=",">
										#siteList[]#
									</iterate>
                                 )))
			</isNotEmpty>
		 <![CDATA[
	        AND   ROWNUM <= #offset# + #length#) t1
            WHERE rnum >#offset#
		 ]]>

	</select>
	    <select id="DCMS-DCMS-COUNT-USE-BY-NAME-USERID" parameterClass="java.util.Map"
		resultClass="java.lang.Integer">
	     <![CDATA[
		    SELECT count(u.user_id) FROM CMS_USER u
	        WHERE (u.FULL_NAME LIKE '%'||#userId#||'%' OR u.USER_ID LIKE '%'||#userId#||'%')
	     ]]>
	 		<isNotEmpty prepend="AND" property="roleId" >
				U.USER_ID IN (SELECT DISTINCT USR.USER_ID
                               FROM CMS_USER USR, CMS_USER_ROLE R
                              WHERE USR.USER_ID = R.USER_ID
                                AND R.ROLE_ID = #roleId#)
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="isSite" >
			(U.USER_ID IN (SELECT DISTINCT USR.USER_ID
                                FROM CMS_USER USR
                               WHERE USR.DEP_ID  IN (
                                 <iterate property="depList" conjunction=",">
										#depList[]#
									</iterate>
                                 )) OR
               U.USER_ID IN (SELECT DISTINCT USR.USER_ID
                                FROM CMS_USER USR, CMS_USER_SITE UC
                               WHERE USR.USER_ID = UC.USER_ID
                                 AND UC.END_DATE >= SYSDATE
                                 AND UC.SITE_ID IN (
                                  <iterate property="siteList" conjunction=",">
										#siteList[]#
									</iterate>
                                 )))
			</isNotEmpty>


	</select>
	<delete id="DELETE_USER_ROLE" parameterClass="java.lang.String"  >
        <![CDATA[
            DELETE FROM CMS_USER_ROLE UR WHERE UR.USER_ID = #userId#
        ]]>
    </delete>
    <delete id="DELETE_USER_SITE" parameterClass="java.lang.String"  >
        <![CDATA[
            DELETE FROM CMS_USER_SITE UC WHERE UC.USER_ID = #userId#
        ]]>
    </delete>
	    <select id="DCMS_QUERY_USER_ROLE_TEST" parameterClass="java.util.Map" resultClass="java.lang.Long">
		<![CDATA[
             SELECT  DISTINCT UR.ROLE_ID
				  FROM CMS_USER_ROLE UR
				 WHERE   UR.USER_ID = #userId# AND UR.ROLE_ID = #roleId#
        ]]>
	</select>

	<insert id="DCMS-INSERT-INSERTCMSUSER_ROLE" parameterClass="java.util.Map">
		<selectKey resultClass="java.lang.Long" keyProperty="id">
            SELECT SEQ_CMS_USER_ROLE.NEXTVAL AS id FROM DUAL
        </selectKey>
        <![CDATA[
         INSERT INTO CMS_USER_ROLE
			  (ID, GMT_MODIFIED, GMT_CREATE, USER_ID, ROLE_ID)
			VALUES
			  (#id#, sysdate, sysdate,#userId#, #roleId#)
        ]]>
	</insert>
		<insert id="DCMS-INSERT-USER_SITE" parameterClass="java.util.Map">
		<selectKey resultClass="java.lang.Long" keyProperty="id">
            SELECT SEQ_CMS_USER_SITE.NEXTVAL AS id FROM DUAL
        </selectKey>
        <![CDATA[
         INSERT INTO CMS_USER_SITE
		  (ID, GMT_MODIFIED, GMT_CREATE, SITE_ID, END_DATE, USER_ID)
		VALUES
		  (#id#, sysdate, sysdate, #siteId#, #endDate#, #userId#)
        ]]>
	</insert>
	  <select id="DCMS_QUERY_USER_SITE_TEST"  resultClass="java.lang.Long" parameterClass="java.util.Map">
		  <![CDATA[
		  	SELECT DISTINCT UC.SITE_ID
				  FROM CMS_USER_SITE UC
				 WHERE UC.USER_ID = #userId#
				   AND UC.SITE_ID= #siteId# AND UC.END_DATE >= SYSDATE
		    ]]>
    </select>
    	  <select id="DCMS_QUERY_CATALOG_BY_RESOURCEID_TYPE"  resultClass="java.lang.Long" parameterClass="java.util.Map">
		  <![CDATA[
		   		SELECT DISTINCT RC.CATALOG_ID
					  FROM CMS_RESOURCE_CATALOG_V2 RC
					 WHERE RC.RESOURCE_ID =#resourceId#
					   AND RC.RESOURCE_TYPE =#resourceType#
		    ]]>
    </select>
	  <select id="DCMS_QUERY_USER_SITE"  resultMap="CmsSite-result" parameterClass="java.lang.String">
		  <![CDATA[  SELECT DISTINCT C.ID, C.PARENT_ID, C.NAME, 'false' AS CHECKED
		    FROM CMS_USER_SITE UC, CMS_SITE C
		   WHERE UC.SITE_ID = C.ID
		     AND UC.USER_ID = #userId# AND UC.END_DATE >= SYSDATE ]]>
    </select>
    <!-- 通过类目ID获得其所有父类目 -->
    <select id="DCMS_QUERY_USER_PARENT_SITE_BY_SITEID"  resultMap="CmsSite-result" parameterClass="java.lang.Long">
		  <![CDATA[
		  SELECT C.ID, C.PARENT_ID, C.NAME, 'false' AS CHECKED
			  FROM CMS_SITE C
			 START WITH C.ID = #siteId#
			CONNECT BY PRIOR C.PARENT_ID = C.ID
		    ]]>
    </select>
    <!-- 通过用户ID和部门获得用户所有类目 -->
      <select id="DCMS_QUERY_USER_SITE_BY_USER_AND_DEPID"  resultClass="java.lang.Long" parameterClass="java.util.Map">
		  <![CDATA[
			  SELECT DISTINCT SITE_ID
	  FROM ((SELECT UC.SITE_ID
	           FROM CMS_USER_SITE UC
	          WHERE UC.USER_ID = #userId# and UC.end_date>=SYSDATE) UNION
	        (SELECT DC.SITE_ID
	           FROM CMS_DEPARTMENT_SITE DC
	          WHERE DC.DEP_ID = #depId#))
		    ]]>
    </select>
    <!-- 通过部门获得用户归属类目 -->
      <select id="DCMS_QUERY_USER_SITE_BY_DEPID"  resultClass="java.lang.Long" parameterClass="java.util.Map">
		  <![CDATA[
			  SELECT DISTINCT DC.SITE_ID
				  FROM CMS_DEPARTMENT_SITE DC
				 WHERE DC.DEP_ID = #depId#
		    ]]>
    </select>
      <select id="DCMS_QUERY_USER_DEP_SITE"  resultMap="CmsSite-result" parameterClass="java.util.Map">
		<![CDATA[ SELECT DISTINCT A.ID, A.PARENT_ID, A.NAME, 'false' AS CHECKED
  FROM CMS_SITE A
 WHERE
            ID IN ((SELECT DISTINCT UC.SITE_ID
                       FROM CMS_USER_SITE UC
                      WHERE UC.USER_ID = #userId# and uc.end_date>=SYSDATE) UNION
                    (SELECT DC.SITE_ID
                       FROM CMS_DEPARTMENT_SITE DC
                      WHERE DC.DEP_ID = #depId#))
			]]>
    </select>
       <select id="DCMS_QUERY_USER_SITE_BY_USER"  resultMap="CmsSite-result" parameterClass="java.lang.String">
		<![CDATA[
		SELECT DISTINCT A.ID, A.PARENT_ID, A.NAME, 'false' AS CHECKED
			  FROM CMS_SITE A
			 WHERE ID IN (SELECT DISTINCT UC.SITE_ID
			                FROM CMS_USER_SITE UC
			               WHERE UC.USER_ID = #userId# and uc.end_date>=SYSDATE)
			 ORDER BY ID
			]]>
    </select>
    <select id="DCMS_QUERY_USER_SITE_BY_ENDDATE"  resultClass="java.util.Date" parameterClass="java.lang.String">
		<![CDATA[
		SELECT DISTINCT UC.END_DATE
			  FROM CMS_USER_SITE UC
			 WHERE UC.USER_ID = #userId# AND UC.END_DATE >= SYSDATE
			]]>
    </select>

    <select id="DCMS_QUERY_DEP_SITE_BY_USER"  resultMap="CmsSite-result" parameterClass="java.lang.String">
		<![CDATA[ SELECT A.ID, A.PARENT_ID, A.NAME, 'false' AS CHECKED
			  FROM CMS_SITE A
			 WHERE ID IN (SELECT DC.SITE_ID
			                             FROM CMS_DEPARTMENT_SITE DC
			                            WHERE DC.DEP_ID = #depId#
			                          )
			]]>
    </select>
    <select id="DCMS_QUERY_USER_DEP_SITE_ADMIN"  resultMap="CmsSite-result" parameterClass="java.lang.Long">
		<![CDATA[ SELECT A.ID, A.PARENT_ID, A.NAME, 'false' AS CHECKED
			  FROM CMS_SITE A
			 START WITH PARENT_ID = #parentId#
			CONNECT BY PRIOR ID = PARENT_ID
			]]>
    </select>
    <select id="DCMS_QUERY_DEP_SITE"  resultMap="CmsDepSite-result" parameterClass="java.util.Map">
		<![CDATA[
			SELECT DISTINCT DC.DEP_ID, DC.SITE_ID
				  FROM CMS_DEPARTMENT_SITE DC WHERE DC.DEP_ID IN (	]]>
				  <iterate property="depList" conjunction=",">
				 			#depList[]#
				 </iterate>
			)
    </select>
      <select id="DCMS_QUERY_PERMISSION_ROLE"  resultMap="CmsPerm-result" parameterClass="java.util.Map">
		<![CDATA[
			SELECT DISTINCT P.PERM_CODE, P.DESCRIPTION
						  FROM CMS_PERMISSION P, CMS_ROLE_PERMISSION RP
						 WHERE P.ID = RP.PERM_ID
						   AND RP.ROLE_ID IN ( ]]>
					  <iterate property="roleList" conjunction=",">
					 			#roleList[]#
					 </iterate>
						)
    </select>
    <select id="DCMS_QUERY_DEP_BY_SITE"  resultMap="CmsDepSite-result" parameterClass="java.util.Map">
		<![CDATA[
			SELECT DISTINCT DC.DEP_ID, DC.SITE_ID
				  FROM CMS_DEPARTMENT_SITE DC WHERE DC.SITE_ID IN (	]]>
				  <iterate property="siteIdList" conjunction=",">
				 			#siteIdList[]#
				 </iterate>
			)
    </select>

	<select id="MS_ITERATE_USER" parameterClass="java.util.Map"
		resultMap="CmsUser-result">
       	  <![CDATA[
            SELECT * FROM (
             SELECT A.*,ROWNUM RN FROM (
               SELECT * FROM CMS_USER
               order by user_id
             ) A WHERE ROWNUM <= #offset# + #length#
            ) WHERE RN > #offset#
      ]]>
	</select>

	<select id="MS_SELECT_USER_BY_DEPARTMENT_ID" resultClass="java.lang.String">
         <![CDATA[
            SELECT USER_ID FROM CMS_USER
         ]]>
		 <isPropertyAvailable property="depId" prepend="where">
			dep_id=#depId#
         </isPropertyAvailable>
	</select>

	<update id="MS_UPDATE_DEPARTMENT_ID" parameterClass="java.util.Map">
		update CMS_USER
		 set DEP_ID = #depId#,
		     GMT_MODIFIED = sysdate
		where USER_ID = #userId#
	</update>

	<select id="MS_SELECT_USER_BY_ROLE_IDS" resultMap="CmsUser-result" parameterClass="Collection">
		<![CDATA[
			SELECT * FROM CMS_USER WHERE USER_ID IN (SELECT USER_ID FROM CMS_USER_ROLE WHERE ROLE_ID IN
		 ]]>
		<iterate open="(" close=")" conjunction=",">
			#[]#
		</iterate>
		<![CDATA[
			)
		]]>
	</select>
	
	<select id="findAclRoleIDByUserID" parameterClass="java.lang.String" resultClass="java.lang.String">
	    <![CDATA[
	        select t.id from acl_role t
             inner join (select r.role_name  from cms_role r
                          inner join (select ur.role_id from cms_user_role ur where ur.user_id = #userID#) ur 
                             on r.id = ur.role_id
                          group by r.role_name) r 
                on t.name = r.role_name
	    ]]>
	</select>
	
	<select id="findAclRoleIDByOldRoleID" parameterClass="java.lang.Long" resultClass="java.lang.String">
	    <![CDATA[
	        select t.id from acl_role t
             inner join (select r.role_name from cms_role r where r.id = #roleID#) r 
                on t.name = r.role_name
	    ]]>
	</select>
</sqlMap>
