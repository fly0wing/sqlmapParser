<?xml version='1.0' encoding="gb2312"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN"
    "http://www.ibatis.com/dtd/sql-map-2.dtd">

<!-- WARNING: This is an autogenerated file -->

<sqlMap namespace="cms_CmsSite">

    <resultMap class="CmsSite" id="CmsSite-result" >
        <result property="gmtCreate"	   javaType="java.sql.Timestamp" column="GMT_CREATE" />
        <result property="gmtModified"	   javaType="java.sql.Timestamp" column="GMT_MODIFIED" />
        <result property="id"			   javaType="java.lang.Long"	 column="ID" />
        <result property="name"			   javaType="java.lang.String"	 column="NAME" />
        <result property="parentId"		   javaType="java.lang.Long"	 column="PARENT_ID" />
		<result property="principal"       javaType="java.lang.String"   column="PRINCIPAL"/>
		<result property="telephone"       javaType="java.lang.String"   column="TELEPHONE"/>
		<result property="remarks"         javaType="java.lang.String"   column="REMARKS"/>
	    <result property="materialLibrary" javaType="java.lang.Integer"  column="MATERIAL_LIBRARY"/>
	    <result property="needAudit"       javaType="java.lang.Integer"  column="NEED_AUDIT"/>
	    <result property="uedAuditors"     javaType="java.lang.String"   column="UED_AUDITORS"/>
	    <result property="lev"             javaType="java.lang.Integer"  column="LEV"/>
	    <result property="expandInfo"      javaType="java.lang.String"   column="EXPAND_INFO"/>
	    <result property="needSafeJudge"   javaType="java.lang.Integer"  column="NEED_SAFE_JUDGE"/>
	    <result property="switchInfo"      javaType="java.lang.String"  column="SWITCH_INFO"/>
    </resultMap>

      <resultMap id="CmsSiteRes-result"  class="java.util.HashMap">
		<result property="id" javaType="java.lang.Long" column="ID" />
		<result property="name" javaType="java.lang.String" column="NAME" />
		<result property="resourceId" javaType="java.lang.Long" column="RESOURCE_ID" />
	</resultMap>

    <resultMap id="CmsSitePath-result"  class="CmsSite">
		<result property="id"         javaType="java.lang.Long"         column="ID" />
		<result property="name"       javaType="java.lang.String"       column="NAME" />
		<result property="remarks"    javaType="java.lang.String"       column="REMARKS"/>
	</resultMap>

    <select id="getCmsSite" parameterClass="java.lang.Long" resultMap="CmsSite-result">
        <![CDATA[
            SELECT * FROM CMS_SITE where ID = #id#
        ]]>
    </select>

    <delete id="deleteCmsSite" parameterClass="java.lang.Long"  >
        <![CDATA[
            delete from CMS_SITE where ID = #id#
        ]]>
    </delete>

    <select id="MS-SELECT-ALL-CMSSITE" resultClass="CmsSite" resultMap="CmsSite-result" >
        <![CDATA[
            select * from CMS_SITE order by GMT_CREATE desc
        ]]>
    </select>

    <select id="MS-SELECT-ALL-PARENT-CMSSITE" parameterClass="java.lang.Long"  resultClass="java.lang.Long" >
        <![CDATA[
            select id from CMS_SITE where parent_id=#value# order by id desc
        ]]>
    </select>

    <select id="MS-GET-ALL-PRIMARY-SITES" resultClass="CmsSite">
        <![CDATA[
            select * from CMS_SITE WHERE parent_id=0 order by id desc
        ]]>
    </select>
    
    <select id="MS-GET-ALL-PRIMARY-SITES-AND-COUNT" parameterClass="java.lang.Long" resultClass="CmsSite">
        <![CDATA[
            select s.id, s.name, count(s.id) count
              from cms_site t
             inner join (select t.id, t.name from cms_site t where t.parent_id = #pid#) s on t.parent_id = s.id
             where t.parent_id > #pid#
             group by s.id, s.name
        ]]>
    </select>
    
    <select id="getALLChildListSites" parameterClass="java.util.Map" resultClass="CmsSite">
        <![CDATA[
            select t.id, t.name, p.name pname
              from cms_site t 
             inner join (select p.id, p.name from cms_site p where p.parent_id = #pid#) p
                on t.parent_id = p.id
        ]]>
        <dynamic prepend="where">
            <isNotEmpty prepend="and" property="pid">
                t.parent_id > #pid#
            </isNotEmpty>
            <isNotEmpty prepend="and" property="siteName">
                t.name like '%$siteName$%'
            </isNotEmpty>
            <isNotEmpty prepend="and" property="siteIDs">
                t.id in
                <iterate property="siteIDs" open="(" close=")" conjunction=",">
			          #siteIDs[]#
		        </iterate>
            </isNotEmpty>
		</dynamic>
    </select>
    
    <select id="getChildListSitesByPid" parameterClass="java.util.Map" resultClass="CmsSite">
        <![CDATA[
            select t.id, t.name from cms_site t
        ]]>
        <dynamic prepend="where">
            <isNotEmpty prepend="and" property="siteName">
                t.name like '%$siteName$%'
            </isNotEmpty>
            <isNotEmpty prepend="and" property="pid">
                t.parent_id = #pid#
            </isNotEmpty>
		</dynamic>
    </select>

	<select id="MS_SELECT_FIRSTSITE_BY_PRAENT_ID" resultMap="CmsSite-result" parameterClass="map">
		<![CDATA[
			SELECT * FROM (
				SELECT site.*,ROWNUM rn FROM (
					SELECT * FROM CMS_SITE where PARENT_ID = #parentId#	order by ID DESC
				) site where ROWNUM <= #offerset# + #length#
			) where rn>#offerset#
		]]>
	</select>
	<select id="MS_COUNT_SITE_BY_PARENTID" resultClass="java.lang.Long" parameterClass="java.lang.Long">
		<![CDATA[
			SELECT COUNT(*) FROM CMS_SITE WHERE PARENT_ID = #parentId#
		]]>
	</select>
	<select id="MS_COUNT_SITE_BY_PARENTID_AND_NAME" parameterClass="map" resultClass="java.lang.Integer">
		<![CDATA[
			SELECT COUNT(*) FROM CMS_SITE WHERE NAME = #name#  AND PARENT_ID = #parentId#
		]]>
		<isGreaterThan prepend="AND" property="id" compareValue="0">
			ID != #id#
		</isGreaterThan>
	</select>


	<!-- insert id="MS_ADD_SITE" parameterClass="CmsSite">
		<selectKey resultClass="java.lang.Long" keyProperty="id">
			SELECT SEQ_CMS_SITE.NEXTVAL AS ID FROM DUAL
		</selectKey>
		<![CDATA[
			INSERT INTO CMS_SITE
				(GMT_CREATE , GMT_MODIFIED , ID , NAME ,  PARENT_ID , REMARKS,MATERIAL_LIBRARY ,NEED_AUDIT ,UED_AUDITORS,LEV,PRINCIPAL, EXPAND_INFO)
			values
				(SYSDATE , SYSDATE , #id# , #name# , #parentId# , #remarks# , #materialLibrary# , #needAudit# , #uedAuditors#,#lev#,#principal#, #expandInfo#)
		]]>
	</insert -->
	
	<insert id="MS_ADD_SITE" parameterClass="CmsSite">
	    <selectKey resultClass="java.lang.Long" keyProperty="id">
			SELECT SEQ_CMS_SITE.NEXTVAL AS ID FROM DUAL
		</selectKey>
		<![CDATA[
	        insert into cms_site
	    ]]>
	    <dynamic prepend="(">
            <isNotEmpty prepend="," property="id">
                id
            </isNotEmpty>
            <isNotEmpty prepend="," property="gmtCreate">
                gmt_create
            </isNotEmpty>
            <isNotEmpty prepend="," property="gmtModified">
                gmt_modified
            </isNotEmpty>
            <isNotEmpty prepend="," property="name">
                name
            </isNotEmpty>
            <isNotEmpty prepend="," property="parentId">
                parent_id
            </isNotEmpty>
            <isNotEmpty prepend="," property="principal">
                principal
            </isNotEmpty>
            <isNotEmpty prepend="," property="telephone">
                telephone
            </isNotEmpty>
            <isNotEmpty prepend="," property="lev">
                lev
            </isNotEmpty>
            <isNotEmpty prepend="," property="remarks">
                remarks
            </isNotEmpty>
            <isNotEmpty prepend="," property="materialLibrary">
                material_library
            </isNotEmpty>
            <isNotEmpty prepend="," property="uedAuditors">
                ued_auditors
            </isNotEmpty>
            <isNotEmpty prepend="," property="needAudit">
                need_audit
            </isNotEmpty>
            <isNotEmpty prepend="," property="expandInfo">
                expand_info
            </isNotEmpty>
            <isNotEmpty prepend="," property="needSafeJudge">
                need_safe_judge
            </isNotEmpty>
            <isNotEmpty prepend="," property="switchInfo">
                switch_info
            </isNotEmpty>
	    </dynamic>
	    <dynamic prepend=") values (">
            <isNotEmpty prepend="," property="id">
                #id#
            </isNotEmpty>
            <isNotEmpty prepend="," property="gmtCreate">
                SYSDATE
            </isNotEmpty>
            <isNotEmpty prepend="," property="gmtModified">
                SYSDATE
            </isNotEmpty>
            <isNotEmpty prepend="," property="name">
                #name#
            </isNotEmpty>
            <isNotEmpty prepend="," property="parentId">
                #parentId#
            </isNotEmpty>
            <isNotEmpty prepend="," property="principal">
                #principal#
            </isNotEmpty>
            <isNotEmpty prepend="," property="telephone">
                #telephone#
            </isNotEmpty>
            <isNotEmpty prepend="," property="lev">
                #lev#
            </isNotEmpty>
             <isNotEmpty prepend="," property="remarks">
                #remarks#
            </isNotEmpty>
            <isNotEmpty prepend="," property="materialLibrary">
                #materialLibrary#
            </isNotEmpty>
            <isNotEmpty prepend="," property="uedAuditors">
                #uedAuditors#
            </isNotEmpty>
            <isNotEmpty prepend="," property="needAudit">
                #needAudit#
            </isNotEmpty>
            <isNotEmpty prepend="," property="expandInfo">
                #expandInfo#
            </isNotEmpty>
            <isNotEmpty prepend="," property="needSafeJudge">
                #needSafeJudge#
            </isNotEmpty>
            <isNotEmpty prepend="," property="switchInfo">
                #switchInfo#
            </isNotEmpty>
	    </dynamic>)
	</insert>
	
	<update id="MS_UPDATE_SITE_BY_ID" parameterClass="CmsSite">
	    <![CDATA[
		    update cms_site t
		]]> 
        <dynamic prepend="set">
            <isNotEmpty prepend="," property="gmtModified">
                t.gmt_modified = sysdate
            </isNotEmpty>
            <isNotEmpty prepend="," property="name">
                t.name = #name#
            </isNotEmpty>
            <isNotEmpty prepend="," property="parentId">
                t.parent_id = #parentId#
            </isNotEmpty>
            <isNotEmpty prepend="," property="principal">
                t.principal = #principal#
            </isNotEmpty>
            <isNotEmpty prepend="," property="telephone">
                t.telephone = #telephone#
            </isNotEmpty>
            <isNotEmpty prepend="," property="remarks">
                t.remarks = #remarks#
            </isNotEmpty>
            <isNotEmpty prepend="," property="materialLibrary">
                t.material_library = #materialLibrary#
            </isNotEmpty>
            <isNotEmpty prepend="," property="needAudit">
                t.need_audit = #needAudit#
            </isNotEmpty>
            <isNotEmpty prepend="," property="uedAuditors">
                t.ued_auditors = #uedAuditors#
            </isNotEmpty>
            <isNotEmpty prepend="," property="expandInfo">
                t.expand_info = #expandInfo#
            </isNotEmpty>
            <isNotEmpty prepend="," property="needSafeJudge">
                t.need_safe_judge = #needSafeJudge#
            </isNotEmpty>
            <isNotEmpty prepend="," property="switchInfo">
                t.switch_info = #switchInfo#
            </isNotEmpty>
        </dynamic>
        <![CDATA[
		    where t.id = #id#
		]]>  
	</update>
	
	<!-- update id="MS_UPDATE_SITE_BY_ID" parameterClass="CmsSite" >
        <![CDATA[
            update CMS_SITE
               set GMT_MODIFIED     = sysdate,
                   NAME             = #name#,
				   PARENT_ID        = #parentId#,
				   PRINCIPAL        = #principal#,
				   TELEPHONE        = #telephone#,
				   REMARKS          = #remarks#,
				   MATERIAL_LIBRARY = #materialLibrary#,
				   NEED_AUDIT       = #needAudit#,
				   UED_AUDITORS     = #uedAuditors#,
				   EXPAND_INFO      = #expandInfo#
             where ID = #id#
        ]]>
    </update -->

	<select id="getParentCatagorysByLetterASC" resultClass="CmsSite">
        <![CDATA[
            select * from CMS_SITE where PARENT_ID=0 order by NAME asc
        ]]>
    </select>

    <select id="getCmsSiteByResource" parameterClass="java.util.Map" resultMap="CmsSite-result">
        <![CDATA[
            SELECT * FROM CMS_SITE where ID in (	SELECT SITE_ID FROM CMS_RESOURCE_SITE where RESOURCE_ID=#resourceId# and RESOURCE_TYPE=#resourceType#)
        ]]>
    </select>
    <select id="MS_GET_RESOURCE_SITE" parameterClass="java.util.Map" resultClass="java.lang.Long">
        <![CDATA[
            SELECT P.SITE_ID
			  FROM CMS_RESOURCE_SITE P
			 WHERE P.RESOURCE_ID = #resourceId#
			   AND P.RESOURCE_TYPE = #resourceType#
        ]]>
    </select>
	<select id="MS_GET_SITES_BY_IDS" resultMap="CmsSite-result" parameterClass="Collection">
		SELECT * FROM CMS_SITE WHERE ID in
		<iterate open="(" close=")" conjunction=",">
			#[]#
		</iterate>
	</select>

	<select id="DCMS_QUERY_SITE_BY_RESOURCEID"  resultMap="CmsSiteRes-result" parameterClass="java.util.Map">
		<![CDATA[
			SELECT DISTINCT C.ID, C.NAME, RC.RESOURCE_ID
				  FROM CMS_SITE C, CMS_RESOURCE_SITE RC
				 WHERE C.ID = RC.SITE_ID
				   AND RC.RESOURCE_TYPE = #resourceType#
				   AND RC.RESOURCE_ID IN (
				  	]]>
				  <iterate property="resList" conjunction=",">
				 			#resList[]#
				 </iterate>
			)
    </select>


     <select id="MS-SELECT-SITE-BY-PARENT-ID" parameterClass="java.lang.Long"  resultClass="CmsSite" >
        <![CDATA[
            select * from CMS_SITE where parent_id=#value# order by id desc
        ]]>
    </select>

	<select id = "MS-SELECT-SITE-IDS-TREE" parameterClass="Collection" resultClass = "java.lang.Long" >
    	<![CDATA[
            SELECT ID FROM CMS_SITE START WITH ID IN
        ]]>
			<iterate open="(" close=")" conjunction=",">
			#[]#
			</iterate>
    	<![CDATA[
			 CONNECT BY NOCYCLE PRIOR ID = PARENT_ID
        ]]>
    </select>

    <select id="MS-SELECT-SITE-PATH" parameterClass="java.util.List" resultMap="CmsSitePath-result">
        <![CDATA[
		SELECT ID, NAME, sys_connect_by_path(ID,'/') as REMARKS
		from CMS_SITE b
		WHERE PARENT_ID=0
		]]>
	    START WITH ID in
		<iterate open="(" close=")" conjunction=",">
			#[]#
		</iterate>
		<![CDATA[
		CONNECT BY NOCYCLE PRIOR  parent_id = id
		ORDER BY ID ASC, REMARKS ASC
		]]>
	</select>
	
	<select id="getCmsSiteByPageID" parameterClass="java.lang.Long" resultMap="CmsSite-result">
        <![CDATA[
            select cs.*
              from cms_site cs
             inner join cms_resource_site crs 
                on cs.id = crs.site_id
             where crs.resource_type = 'page' and crs.resource_id = #value#
        ]]>
    </select>
    
    <select id="getResourceIDBySiteID" parameterClass="java.util.Map" resultClass="java.lang.Long">
        <![CDATA[
            select t.resource_id 
              from cms_resource_site t 
             where t.resource_type = #resourceType#
               and t.site_id = #siteID#
        ]]>
    </select>
	
</sqlMap>
